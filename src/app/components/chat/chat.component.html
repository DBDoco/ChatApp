<div class="overflow-y-auto bg-gray-100 w-full h-full">
  <div *ngFor="let message of messages; let i = index;">
    <div *ngIf="message.sender !== authService.auth.currentUser?.uid" class="chat chat-start p-3">
      <div class="chat-image avatar">
        <div class="w-10 rounded-full">
          <img alt="Profile Picture" [src]="message.senderProfilePicture" />
        </div>
      </div>
      <div class="chat-header">
        {{ message.senderDisplayName }}
        <time class="text-xs opacity-50">{{ convertTimestamp(message.timestamp) | date:'dd.MM.YYYY | HH:mm' }}</time>
      </div>
      <div class="chat-bubble-container flex gap-2">
        <div class="chat-content">
          <div class="chat-bubble custom-bubble text-white break-all max-w-lg pointer" (click)="onMessageClick(message.content)">
            {{ message.content }}
          </div>
          <div class="respond-button text-xs">
            Click on message to respond with AI
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="message.sender === authService.auth.currentUser?.uid" class="chat chat-end p-3">
      <div class="chat-image avatar">
        <div class="w-10 rounded-full">
          <img alt="Profile Picture" [src]="authService.auth.currentUser?.photoURL" />
        </div>
      </div>
      <div class="chat-header">
        {{ message.senderDisplayName }}
        <time class="text-xs opacity-50">{{ convertTimestamp(message.timestamp) | date:'dd.MM.YYYY | HH:mm' }}</time>
      </div>
      <div class="chat-bubble-container relative">
        <div class="chat-bubble text-white break-all max-w-lg">
          {{ message.content }}
          <span *ngIf="message.autoGenerated" class="ml-2 bg-blue-200 text-blue-800 text-xs px-2 py-1 rounded-full">AI</span>
        </div>
      </div>
      <div class="chat-footer opacity-50">
        {{ message.status | titlecase }}
      </div>
    </div>
  </div>
  <div #bottom></div>
</div>

<div class="input-wrapper">
  <nz-input-group nzSearch nzSize="large" [nzAddOnAfter]="suffixButton">
    <input [(ngModel)]="messageContent" (click)="updateMessageStatusOnInput()" type="text" nz-input placeholder="Send a message..." (keydown.enter)="sendMessage()" />
  </nz-input-group>
  <div *ngIf="isAITyping" class="typing-indicator">
    <div class="dot-flashing"></div> AI is typing...
  </div>
</div>

<ng-template #suffixButton>
  <button nz-button nzSearch>
    <span nz-icon nzType="send" (click)="sendMessage()"></span>
  </button>
  <button nz-button class="h-10" (click)="requestAutoResponse()">
    <span nz-icon nzType="robot"></span> AI Response
  </button>
</ng-template>

<div class="flex justify-between items-center p-4 bg-white shadow-md">
  <button class="bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded" (click)="sendHashtagRequest()">
    Regenerate Hashtags
  </button>
  <div class="ml-4">
    <div *ngFor="let hashtag of generatedHashtags" class="inline-block bg-blue-100 text-blue-800 font-semibold mr-2 mb-2 p-2 rounded">
      {{ hashtag }}
    </div>
  </div>
</div>

